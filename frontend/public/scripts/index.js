var c=(a,e,t)=>new Promise((i,o)=>{var s=d=>{try{r(t.next(d));}catch(u){o(u);}},m=d=>{try{r(t.throw(d));}catch(u){o(u);}},r=d=>d.done?i(d.value):Promise.resolve(d.value).then(s,m);r((t=t.apply(a,e)).next());});var n=a=>{let e=document.getElementById(a);if(!e)throw new Error(`Element with id "${a}" not found`);return e},p=(a,e)=>{let t=n("modal-title"),i=n("modal-content");t.innerText=a,i.innerHTML=e,document.getElementsByClassName("modal-backdrop fade show").length||(new bootstrap.Modal("#modal").show(),setTimeout(()=>{n("modal-button").focus();},200));},l={success:a=>{p("\u6210\u529F",a.data.data);},failed:a=>e=>{if(axios.isAxiosError(e)&&e.response){let t=a==null?void 0:a[e.response.status];t?t instanceof Function?p("\u932F\u8AA4",t(e.response.data)):p("\u932F\u8AA4",t):e.response.status===401?(alert("\u767B\u5165\u903E\u6642\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165"),window.location.replace("/")):p("\u932F\u8AA4",`\u672A\u77E5\u7684\u932F\u8AA4\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66
\u82E5\u554F\u984C\u6301\u7E8C\u767C\u751F\uFF0C\u8ACB\u806F\u7D61\u7BA1\u7406\u54E1`);}else p("\u932F\u8AA4",`\u672A\u77E5\u7684\u932F\u8AA4\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66
\u82E5\u554F\u984C\u6301\u7E8C\u767C\u751F\uFF0C\u8ACB\u806F\u7D61\u7BA1\u7406\u54E1`);}};var w;(w=document.getElementById("form-login"))==null||w.addEventListener("submit",a=>{a.preventDefault();let e=n("input-username"),t=n("input-password");axios.post("/api/users/login",{username:e.value,password:t.value}).then(()=>{let i=new Date().toLocaleString("en-US",{timeZone:"Asia/Taipei",year:"numeric"});window.location.replace(`/${i}/task`);}).catch(l.failed({401:"\u7121\u6548\u7684\u4F7F\u7528\u8005\u540D\u7A31\u6216\u5BC6\u78BC"}));});var E;(E=document.getElementById("button-logout"))==null||E.addEventListener("click",()=>{axios.get("/api/users/logout").catch().finally(()=>{window.location.replace("/");});});var f;(f=document.getElementById("button-task-add"))==null||f.addEventListener("click",()=>{n("input-id").value="",n("input-date").value="",n("input-title").value="",n("input-content").value="",n("input-responsible").innerHTML="<option value=''></option>"+window.users.map(a=>`<option value="${a.id}">${a.nickname}</option>`).join(""),n("input-internal-status").value="",n("input-external-status").value="";});var T;(T=document.getElementById("button-task-delete"))==null||T.addEventListener("click",()=>{let a=n("input-id");a.value!==""&&axios.delete(`/api/tasks/${a.value}`).then(()=>{window.location.reload();}).catch(e=>setTimeout(()=>{l.failed()(e);},200));});var v;(v=document.getElementById("form-task"))==null||v.addEventListener("submit",a=>{a.preventDefault();let e=n("input-id"),t=n("input-date"),i=n("input-title"),o=n("input-content"),s=document.getElementById("input-responsible"),m=n("input-internal-status"),r=n("input-external-status"),d={date:t.value||null,title:i.value,content:o.value,responsibleId:s?s.value||null:void 0,internalStatus:m.value,externalStatus:r.value};new bootstrap.Modal("#modal-task").hide(),(e.value?axios.put(`/api/tasks/${e.value}`,d):axios.post(`/api/tasks/${year}`,d)).then(()=>{window.location.reload();}).catch(u=>setTimeout(()=>{l.failed()(u);},200));});var H=()=>c(null,null,function*(){let a=document.getElementById("tbody-task");a&&(yield Promise.all([axios.get("/api/users"),axios.get("/api/tasks",{params:{year}})]).then(([e,t])=>{window.users=e.data.data,window.tasks=t.data.data.map(i=>(i.date=i.date?new Date(i.date).toISOString().split("T")[0]:null,i));}),a.innerHTML=window.tasks.sort((e,t)=>{let i=e.date?new Date(e.date):new Date(0),o=t.date?new Date(t.date):new Date(0);return i.getTime()-o.getTime()}).map(e=>{var t,i,o;return `
          <tr style="height: 55px">
            <td hidden>${e.id}</td>
            <td style="width: 1px; white-space: nowrap">${(t=e.date)!=null?t:""}</td>
            <td>${e.title}</td>
            <td style="white-space: pre-wrap">${e.content}</td>
            <td style="width: 1px; white-space: nowrap">${(o=(i=window.users.find(s=>s.id===e.responsibleId))==null?void 0:i.nickname)!=null?o:""}</td>
            <td style="white-space: pre-wrap">${e.internalStatus}</td>
            <td style="white-space: pre-wrap">${e.externalStatus}</td>
            <td style="width: 1px; white-space: nowrap">${e.editable?`<button class="btn btn-warning button-task-edit" type="button" data-bs-toggle="modal" data-bs-target="#modal-task" name="${e.id}">\u7DE8\u8F2F</button>`:""}</td>
          </tr>
          `}).join(""),document.querySelectorAll(".button-task-edit").forEach(e=>{e.addEventListener("click",()=>{var o;let t=window.tasks.find(s=>s.id===e.name);if(!t)return;n("input-id").value=e.name,n("input-date").value=(o=t.date)!=null?o:"",n("input-title").value=t.title,n("input-content").value=t.content;let i=document.getElementById("input-responsible");i&&(i.innerHTML="<option value=''></option>"+window.users.map(s=>`
                    <option value="${s.id}" ${s.id===t.responsibleId?"selected":""}>${s.nickname}</option>
                    `).join("")),n("input-internal-status").value=t.internalStatus,n("input-external-status").value=t.externalStatus;});}));});H().catch(l.failed());var g;(g=document.getElementById("form-upload-keys"))==null||g.addEventListener("submit",a=>{var i,o;a.preventDefault();let e=n("input-file"),t=new FormData;t.append("file",(o=(i=e.files)==null?void 0:i[0])!=null?o:new Blob),axios.post("/api/files/keys",t).then(()=>{window.location.reload();}).catch(l.failed({413:"\u6A94\u6848\u904E\u5927\uFF0C\u8ACB\u4E0A\u50B3\u5C0F\u65BC 10MB \u7684\u6A94\u6848"}));});var L;(L=document.getElementById("form-upload-venues"))==null||L.addEventListener("submit",a=>{var i,o;a.preventDefault();let e=n("input-file"),t=new FormData;t.append("file",(o=(i=e.files)==null?void 0:i[0])!=null?o:new Blob),axios.post("/api/files/venues",t).then(()=>{window.location.reload();}).catch(l.failed({413:"\u6A94\u6848\u904E\u5927\uFF0C\u8ACB\u4E0A\u50B3\u5C0F\u65BC 10MB \u7684\u6A94\u6848"}));});var I;(I=document.getElementById("form-upload-activity-center"))==null||I.addEventListener("submit",a=>{var i,o;a.preventDefault();let e=n("input-file"),t=new FormData;t.append("file",(o=(i=e.files)==null?void 0:i[0])!=null?o:new Blob),axios.post("/api/files/activity-center",t).then(()=>{window.location.reload();}).catch(l.failed({413:"\u6A94\u6848\u904E\u5927\uFF0C\u8ACB\u4E0A\u50B3\u5C0F\u65BC 10MB \u7684\u6A94\u6848"}));});var x;(x=document.getElementById("form-upload-entrance"))==null||x.addEventListener("submit",a=>{var i,o;a.preventDefault();let e=n("input-file"),t=new FormData;t.append("file",(o=(i=e.files)==null?void 0:i[0])!=null?o:new Blob),axios.post("/api/files/entrance",t).then(()=>{window.location.reload();}).catch(l.failed({413:"\u6A94\u6848\u904E\u5927\uFF0C\u8ACB\u4E0A\u50B3\u5C0F\u65BC 10MB \u7684\u6A94\u6848"}));});document.addEventListener("hide.bs.modal",()=>{document.activeElement&&document.activeElement.blur();});